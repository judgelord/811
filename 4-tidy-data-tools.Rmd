---
title: "Tidy data & readable code"
author: "Devin Judge-Lord"
date: 
output: 
  html_document:
  toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if(!"here" %in% rownames(installed.packages())){
install.packages("here", repos = "https://cloud.r-project.org/" )}
library(here)
#source(here(setup.R))
library(tidyverse)
library(magrittr)
```

# Read in data
## Loading saved R objects
`load()` works for objects saved as .Rdata from a local file or the web

## New R objects
### `d <- read.csv()` loads comma seperated values (a plain text spreadsheet)
### `d <- read.dta13()` loads stata data files int r

---
# Naming things
## One of the hardest problems in computer science

## Objects 
### `d` for data with which you are working
### A more descriptive name for the original object (e.g. `d <- regulations`)
### `m1` or `model.1`for models, corresponding to how you discuss them the text

## Variables

### **Never** name variables x1, x2 or variable1, varible2, in real data!

### Good names make things easy to find, recall, guess

--

### varying vs. FIXED variables
- the most common convention, aligned with math notation

### dataset1 vs. DATASET2
- if the source is key (e.g. when joining two similar datasets)

### new_text vs. OLD_TEXT
- new_text = tolower(OLD_TEXT)

--

### Common beginning for similar variables, figures, documents
#### variables
- `d$commentId`, `d$commentText`, `d$commentTotal`, `d$commentUnique`, `d$commentUniqueTotal`
#### figures
- commentsPerYear.png, commentsPerAgency.png, commentsPerAgencyPerYear.png
#### documents
- budgetEPA2016.pdf, budgetEPA2017.pdf, budgetEPA2018.pdf


---

#[Tidyverse](https://magrittr.tidyverse.org/articles/magrittr.html)

## Data manipulation with [dplyr](https://dplyr.tidyverse.org/)

### `filter` data by logical conditions
```{r starwars_droids}
filter(starwars, species == "Droid")
```

### `summarize` by group (`n()`, `mean()`, `max()`, etc.)
```{r starwars_species}
starwars %>% 
  group_by(species) %>% 
  summarize(species_N = n()) %>% 
  arrange(-species_N)
```

### New variables with `mutate`
```{r starwars_species2}
starwars %>% 
  group_by(species) %>% 
  mutate(species_height = mean(height, na.rm = TRUE) ) %>% 
  mutate(species_height = round(species_height, 1) ) %>% 
  mutate(eye_colors = paste(unique(eye_color), collapse = ";")) %>%
  select(species, species_height, eye_colors) %>% 
  distinct() 
```

---

# Readable code 
## Nest vs. piecemeal vs. pipe

### Functions can be nested
```{r nest}
select(
  filter(
    filter(
      filter(starwars, species == "Droid"),
      eye_color == "yellow"),
    skin_color == "gold"),
  name, homeworld, ends_with("color"))
```
### But this can be confusing and hard to edit.

--

### Lets define an object and modify it.
```{r piecemeal}
d <- starwars
d <- filter(d, species == "Droid") 
## we can streamline by "piping" d in as the first argument with %<>%
## %<>% pipes in and back out, thus modifying d, just like above
d %<>% filter(eye_color == "yellow") 
d %<>% filter(skin_color == "gold")
select(d, name, homeworld, ends_with("color"))
```
### better, certaianly easier to read

--
## Now lets just pipe the object `starwars` to a series of functions with `%>%` from the [`magrittr`](https://magrittr.tidyverse.org/articles/magrittr.html) package
```{r pipe}
starwars %>% 
  ## %>% pipes one way, allowing us to string functions together
  filter(species == "Droid") %>% 
  filter(eye_color == "yellow") %>% 
  filter(skin_color == "gold") %>% 
  select(name, homeworld, ends_with("color"))
  
```
## even better
---
# Make new variables

